# 웹 호스팅 서비스 프록시 설정
server {
    listen 8080 default_server;
    server_name _;
    
    # 메인 페이지
    location = / {
        return 200 '
        <!DOCTYPE html>
        <html>
        <head>
            <title>웹 호스팅 서비스</title>
            <style>
                body { 
                    font-family: Arial, sans-serif; 
                    text-align: center; 
                    padding: 50px;
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                }
                .container { 
                    background: rgba(255,255,255,0.1); 
                    padding: 30px; 
                    border-radius: 10px; 
                    display: inline-block;
                }
                .user-list {
                    text-align: left;
                    margin: 20px 0;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>🚀 웹 호스팅 서비스</h1>
                <p>사용자별 접속 방법:</p>
                <div class="user-list">
                    <p>• /7 - 사용자 ID 7의 웹호스팅</p>
                    <p>• /8 - 사용자 ID 8의 웹호스팅</p>
                    <p>• 직접 접속: :8XXX 포트</p>
                </div>
                <p><strong>접속 URL: http://192.168.122.115:8080/</strong></p>
            </div>
        </body>
        </html>';
        add_header Content-Type text/html;
    }
    
    # 사용자 7번 프록시 (예시)
    location /7 {
        rewrite ^/7(/.*)$ $1 break;
        rewrite ^/7$ / break;
        proxy_pass http://127.0.0.1:8007;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # 사용자 8번 프록시 (예시)  
    location /8 {
        rewrite ^/8(/.*)$ $1 break;
        rewrite ^/8$ / break;
        proxy_pass http://127.0.0.1:8008;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    # 동적 사용자 프록시 (범위: 1-50)
    location ~ ^/([1-9]|[1-4][0-9]|50)$ {
        set $user_id $1;
        rewrite ^/([1-9]|[1-4][0-9]|50)$ / break;
        proxy_pass http://127.0.0.1:80$user_id;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    
    location ~ ^/([1-9]|[1-4][0-9]|50)/ {
        set $user_id $1;
        rewrite ^/([1-9]|[1-4][0-9]|50)/(.*) /$2 break;
        proxy_pass http://127.0.0.1:80$user_id;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
