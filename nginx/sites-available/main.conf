# ë©”ì¸ ì›¹ í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤ ì‚¬ì´íŠ¸ ì„¤ì •
server {
    listen 80 default_server;
    listen [::]:80 default_server;
    server_name localhost _;
    
    # ë©”ì¸ í˜ì´ì§€ - í†µí•©ëœ ì›¹ í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤ ì†Œê°œ
    location = / {
        return 200 '
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš€ ì›¹ í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container { 
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            max-width: 600px;
        }
        h1 { font-size: 2.5rem; margin-bottom: 20px; }
        .subtitle { font-size: 1.2rem; margin-bottom: 30px; opacity: 0.9; }
        .info-box { 
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: left;
        }
        .endpoint { 
            font-family: monospace;
            background: rgba(0, 0, 0, 0.2);
            padding: 8px 12px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 0.9rem;
        }
        .status { color: #2ecc71; font-weight: bold; }
        .highlight { color: #f39c12; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ ì›¹ í˜¸ìŠ¤íŒ… ì„œë¹„ìŠ¤</h1>
        <p class="subtitle">ìë™í™”ëœ VM ê¸°ë°˜ ì›¹ í˜¸ìŠ¤íŒ… í”Œë«í¼</p>
        
        <div class="info-box">
            <h3>âœ… ì„œë¹„ìŠ¤ ìƒíƒœ</h3>
            <p class="status">â€¢ Nginx í”„ë¡ì‹œ: ì •ìƒ ë™ì‘</p>
            <p class="status">â€¢ ì›¹ í˜¸ìŠ¤íŒ…: ì¤€ë¹„ë¨</p>
        </div>
        
        <div class="info-box">
            <h3>ğŸ”— ì‚¬ìš©ì í˜¸ìŠ¤íŒ… ì ‘ì†</h3>
            <p>ì‚¬ìš©ìë³„ ì ‘ì†: <span class="highlight">/{user_id}</span></p>
            <p>ì˜ˆì‹œ: <span class="endpoint">/7</span> (ì‚¬ìš©ì IDê°€ 7ì¸ ê²½ìš°)</p>
            <p>í…ŒìŠ¤íŠ¸: <span class="endpoint">/11</span> (ì‚¬ìš©ì IDê°€ 11ì¸ ê²½ìš°)</p>
        </div>
        
        <div class="info-box">
            <h3>ğŸ“‹ ê¸°ëŠ¥</h3>
            <p>â€¢ ì‚¬ìš©ìë³„ VM ìë™ ìƒì„±</p>
            <p>â€¢ ì›¹ í˜¸ìŠ¤íŒ… í™˜ê²½ ì œê³µ</p>
            <p>â€¢ SSH ì ‘ì† ì§€ì›</p>
        </div>
    </div>
</body>
</html>';
        add_header Content-Type "text/html; charset=utf-8";
        add_header Cache-Control "no-cache";
    }
    
    # ì‚¬ìš©ì 11ë²ˆ ì›¹ í˜¸ìŠ¤íŒ… í”„ë¡ì‹œ ì„¤ì • (í…ŒìŠ¤íŠ¸ìš©)
    location /11 {
        # ê²½ë¡œ ì¬ì‘ì„± (/11/path -> /path)
        rewrite ^/11(/.*)$ $1 break;
        rewrite ^/11$ / break;
        
        # ë¡œì»¬ í…ŒìŠ¤íŠ¸ ì„œë²„ë¡œ í”„ë¡ì‹œ
        proxy_pass http://127.0.0.1:8790;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # ì›¹ì†Œì¼“ ì§€ì›
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        
        # íƒ€ì„ì•„ì›ƒ ì„¤ì •
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        # ì—ëŸ¬ í˜ì´ì§€ ì²˜ë¦¬
        proxy_intercept_errors on;
        error_page 502 503 504 = @fallback_11;
    }
    
    # ì‚¬ìš©ì 11 í´ë°± (ì„œë¹„ìŠ¤ê°€ ì—†ì„ ë•Œ)
    location @fallback_11 {
        return 200 '
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‚¬ìš©ì 11 - ì„œë¹„ìŠ¤ ì¤€ë¹„ ì¤‘</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            text-align: center; 
            padding: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container { 
            background: rgba(255, 255, 255, 0.1);
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
        }
        h1 { color: #f39c12; margin-bottom: 20px; }
        .status { color: #e74c3c; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ì‚¬ìš©ì 11 í˜¸ìŠ¤íŒ…</h1>
        <p class="status">ì„œë¹„ìŠ¤ê°€ ì•„ì§ ì‹œì‘ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
        <p>VMì´ ì‹œì‘ë˜ë©´ ì—¬ê¸°ì— ì›¹ì‚¬ì´íŠ¸ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        <p><a href="/" style="color: #f39c12;">ë©”ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a></p>
    </div>
</body>
</html>';
        add_header Content-Type "text/html; charset=utf-8";
    }
    
    # favicon.ico
    location = /favicon.ico {
        log_not_found off;
        access_log off;
        return 204;
    }
    
    # ë™ì  ì‚¬ìš©ì í˜¸ìŠ¤íŒ… include
    include /etc/nginx/sites-available/hosting/*.conf;
}

# ì‚¬ìš©ìë³„ í˜¸ìŠ¤íŒ… ì‚¬ì´íŠ¸ ì„¤ì •
# ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ì‚¬ìš©ì í˜¸ìŠ¤íŒ…ì€ hosting/ ë””ë ‰í† ë¦¬ì—ì„œ í¬í•¨ë©ë‹ˆë‹¤. 